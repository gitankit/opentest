<?php
header('Cache-Control: no-cache, no-store, max-age=0, must-revalidate');
header('Expires: Mon, 12 Jul 1996 04:11:00 GMT'); //Any date passed.
header('Pragma: no-cache');

session_start();
require_once('../db.php');
require_once('student_functions.php');
if($_GET['resume']=="yes")
  {
      unset($_GET['resume']);
      $secure=1;
  }
if(isset($_POST['Start']))
  {
    unset($_POST['Start']);
    $secure=1;
  }
if(isset($_POST['toggle_previous']))
   {
     $_SESSION['end_index']=$_SESSION['start_index'];
	 $_SESSION['start_index']=$_SESSION['end_index']-10;
         $secure=1;
   }

if(isset($_POST['toggle_next']))
   {
	 $_SESSION['start_index']=$_SESSION['end_index'];
     if(($_SESSION['max_index']-$_SESSION['start_index'])<=10)
	     {
		   $_SESSION['end_index']=$_SESSION['max_index'];
		 }
	 else if(($_SESSION['max_index']-$_SESSION['start_index'])>10)
	     {
		   $_SESSION['end_index']=$_SESSION['start_index']+10;
         }

            $secure=1;

   }
if(isset($_POST['toggle']))
   {
     $_SESSION['selected_answers'][$_SESSION['index']]=$_POST['answer'];
     $_SESSION['index']=$_POST['toggle']-1;
         $secure=1;
   }	 
if(isset($_POST['previous']))
   {
    if($_SESSION['index']!=0)
	  {
	    $_SESSION['selected_answers'][$_SESSION['index']]=$_POST['answer'];  
	    $_SESSION['index']=$_SESSION['index']-1;
	  }
         $secure=1;
   }
 if(isset($_POST['next']))
    {
	  if($_SESSION['index']!=$_SESSION['max_index'])
	     {
		   $_SESSION['selected_answers'][$_SESSION['index']]=$_POST['answer'];
		   $_SESSION['index']=$_SESSION['index']+1;
		 }
         $secure=1;
	}
 if(isset($_POST['Submitanswer']))
    {
	  $_SESSION['answers'][$_SESSION['index']]=$_POST['answer'];
	  $_SESSION['submit_values'][$_SESSION['index']]=1;
         $secure=1;
	}	   
   if($secure==1)
      {
         $sql_question="SELECT * FROM Question WHERE id=".$_SESSION['questions'][$_SESSION['index']];
	 $query_question=mysql_query($sql_question,$connection);
	 $row_question=mysql_fetch_array($query_question);
         $secure=0;
      }
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>
Quiz(Beta) - <?php echo $_SESSION['name']." - ".$_SESSION['qname'] ?>
</title>

<!-- Meta Tags -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- CSS -->
<?php include('../stylesheets.php') ?>

<!-- JavaScript -->
<script type="text/javascript" src="../scripts/table_test.js"></script>
<script type="text/javascript">
function redirect(page) 
   {window.location = page;}
   function submitbox()
   { if(confirm("Timeout ! Click OK to Submit your quiz"))
      {
	    document.form1.Submit();
		document.form2.Submit();
		redirect('submittest.php');
	  }
	}
</script>
<SCRIPT LANGUAGE="Javascript"><!--
var isNS = (navigator.appName == "Netscape") ? 1 : 0;
var EnableRightClick = 0;
if(isNS) 
document.captureEvents(Event.MOUSEDOWN||Event.MOUSEUP);
function mischandler(){
if(EnableRightClick==1){ return true; }
else {return false; }
}
function mousehandler(e){
if(EnableRightClick==1){ return true; }
var myevent = (isNS) ? e : event;
var eventbutton = (isNS) ? myevent.which : myevent.button;
if((eventbutton==2)||(eventbutton==3)) return false;
}
function keyhandler(e) {
var myevent = (isNS) ? e : window.event;
if (myevent.keyCode==96)
EnableRightClick = 1;
return;
}
document.oncontextmenu = mischandler;
document.onkeypress = keyhandler;
document.onmousedown = mousehandler;
document.onmouseup = mousehandler;
//-->
</script>

<style type="text/css">
<!--
.questionlabel {
	text-align: left;
	width: 200px;
	float: left;
}
.answerlabel2 {
	width: 200px;
	float: left;
	padding: 10px;
}
.question {
	width: 400px;
	float: right;
}
-->
</style>
</head>

<body >
<div class="main_container">


<div>
 <table>
   <tr>
     <td><b>Quiz ID :</b> <?php echo $_SESSION['quizid'] ?></td>
     <td><b>Max. Marks :</b> <?php echo $_SESSION['max_marks'] ?> </td>
     <td><b>Time Alloted :</b><?php echo $_SESSION['time_limit'] ?></td>
     <td><b>No. of Questions :</b> <?php echo $_SESSION['no_of_questions'] ?></td>
  </tr>
 </table> 
</div>



<script type="text/javascript">
var cnt = <?php echo round($_SESSION['time']-time()) ?>

function countdown() {
  if (cnt == 0)
    {alert("Time Up ! ");
 window.location.href = "submittest.php";
    }
  else
    {min = Math.floor(cnt / 60);
     sec = cnt - (min * 60);
     if (sec < 10) {sec = "0" + sec;}
     if (min < 10) {min = "0" + min;}
     document.f.c.value = min + ":" + sec;
     cnt--;
     _timer = setTimeout("countdown()", 1000);
    }
}

var _timer = setTimeout("countdown()", 1000); // tick
</script>
<table>
<thead>
<form name="f" onsubmit="return false">
<tr><td><b>Time Remaining</b><span>  </span> <input name="c" type="text" readonly="readonly"></td></tr>
</form>
</thead>
</table>



<div >
<form name="form1" action="taketest.php" method="POST"> 
                                                    
                                                    
                                                     <!-- Question -->
<table>
 <tr>
   <td><b>Question <?php echo $_SESSION['index']+1 ?> :</b></td><td> <textarea rows="5" cols="50" readonly="readonly"><?php echo $row_question[1] ?></textarea></td></tr></table>



<?php if($_SESSION['correct_answers'][$_SESSION['index']]==$_SESSION['answers'][$_SESSION['index']])
         {
		   $display_flag=1;
		   $correct_answer=$_SESSION['answers'][$_SESSION['index']];
		 }
	   else if ($_SESSION['correct_answers'][$_SESSION['index']]!=$_SESSION['answers'][$_SESSION['index']])
	     {
		   $display_flag=1;
		   $correct_answer=$_SESSION['correct_answers'][$_SESSION['index']];
		   $incorrect_answer=$_SESSION['answers'][$_SESSION['index']];
             }
?>

                                                      
                                                      <!-- Option 1 -->
<table>
<tr><td><?php if($_SESSION['submit_values'][$_SESSION['index']]==1) { if($correct_answer==1) { echo '<img src="../images/accept.gif">'; } else if($incorrect_answer==1) { echo '<img src="../images/delete.gif">'; }  }?>
</td>

<td><input type="radio"  name="answer" value=1 <?php if($_SESSION['selected_answers'][$_SESSION['index']]==1) { echo 'checked="checked" '; } if($_SESSION['submit_values'][$_SESSION['index']]==1) { if($_SESSION['answers'][$_SESSION['index']]==1) { echo 'checked="checked"'; } }?>></td>

<td  align="left"><textarea rows="3" cols="50" readonly="readonly" ><?php echo $row_question[2] ?></textarea></td></tr>



                                                       
                                                       <!--Option 2 -->
<tr><td><?php if($_SESSION['submit_values'][$_SESSION['index']]==1) { if($correct_answer==2) { echo '<img src="../images/accept.gif">'; } else if($incorrect_answer==2) { echo '<img src="../images/delete.gif">'; }  }?></td>

<td><input type="radio"  name="answer" value=2 <?php if($_SESSION['selected_answers'][$_SESSION['index']]==2) { echo 'checked="checked" '; } if($_SESSION['submit_values'][$_SESSION['index']]==1) { if($_SESSION['answers'][$_SESSION['index']]==2) { echo 'checked="checked"'; } }?>></td>
  

<td><textarea rows="3" cols="50" readonly="readonly" ><?php echo $row_question[3] ?></textarea></td></tr>



														
                                                        <!-- Option 3 -->
<tr><td><?php if($_SESSION['submit_values'][$_SESSION['index']]==1) { if($correct_answer==3) { echo '<img src="../images/accept.gif">'; } else if($incorrect_answer==3) { echo '<img src="../images/delete.gif">'; }  }?></td>

<td><input type="radio"  name="answer" value=3 <?php if($_SESSION['selected_answers'][$_SESSION['index']]==3) { echo 'checked="checked" '; } if($_SESSION['submit_values'][$_SESSION['index']]==1) { if($_SESSION['answers'][$_SESSION['index']]==3) { echo 'checked="checked"'; } } ?>></td>

<td><textarea rows="3" cols="50" readonly="readonly"><?php echo $row_question[4] ?></textarea></td></tr>



														
                                                        <!-- Option 4 -->
<tr><td><?php if($_SESSION['submit_values'][$_SESSION['index']]==1) { if($correct_answer==4) { echo '<img src="../images/accept.gif">'; } else if($incorrect_answer==4) { echo '<img src="../images/delete.gif">'; }  }?></td>

<td><input type="radio"  name="answer" value=4 <?php if($_SESSION['selected_answers'][$_SESSION['index']]==4) { echo 'checked="checked" '; } if($_SESSION['submit_values'][$_SESSION['index']]==1) { if($_SESSION['answers'][$_SESSION['index']]==4) { echo 'checked="checked"'; } }?>></td>

<td><textarea rows="3" cols="50" readonly="readonly"><?php echo $row_question[5] ?></textarea></td></tr>

</table>



                                                   <!-- Submit This Question -->
<table>
<tr><td><input type="Submit" name="Submitanswer" value="Submit"  <?php if($_SESSION['submit_values'][$_SESSION['index']]==1) { echo 'disabled';} ?>></td></tr></table>


                                                       <!-- Question Bar -->
<table bgcolor="#FFFFFF">
 <tr>
  <td><input  type="submit" name="previous" value="PREVIOUS" <?php if($_SESSION['index']==0) { echo 'disabled'; } ?> /> </td>
  <td><input name="toggle_previous" type="Submit"  value="<<" <?php if($_SESSION['start_index']==0) { echo 'disabled'; } ?> ></td>

<?php
 if($_SESSION['loaded']==1)
   {
    if($_SESSION['max_index']<=10)
   {
     $_SESSION['end_index']=$_SESSION['max_index'];
   }
else
   {
     $_SESSION['end_index']=$_SESSION['start_index']+10;
	}
}			 

 for($i=$_SESSION['start_index'];$i<$_SESSION['end_index'];$i++)
       {
	     echo '<td><input type="Submit" name="toggle" value="'.($i+1).'" style="border:none" style="color:#000000" style="background-color:" style="font:bolder" style="font:Arial, Helvetica, sans-serif" style="font-size:20px" style="cursor:pointer"/><span></span>';
	     if($_SESSION['submit_values'][$i]==1) { echo '<img src="../images/submitted.gif" />'; }
	     if($_SESSION['submit_values'][$i]==0 && $_SESSION['selected_answers'][$i]!=0) { echo '<img src="../images/selected.gif" />'; }
	     if($_SESSION['submit_values'][$i]==0 && $_SESSION['selected_answers'][$i]==0) { echo '<img src="../images/none.gif" />'; }
		 
	     echo '</td>';
	   }
	     
?>
<td> <input name="toggle_next" type="Submit" value=">>" <?php if($_SESSION['end_index']==$_SESSION['max_index']) { echo "disabled" ; } ?> /></td>
<td><input  type="submit" name="next" value="NEXT " <?php if($_SESSION['index']==$_SESSION['max_index']-1) { echo 'disabled'; } ?> /></td></tr>
</form>
</table>
                                            <!-- Submit complete test-->
<table>
<form action="submittest.php" method="POST">
<tr><td style="text-align:center"><input type="Submit" name="Submit" value="Submit My Test"></td></tr>
</form>
</table>



<?php $_SESSION['loaded']=0;?>
</div>
</body>
</html>
