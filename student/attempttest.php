<?php
header('Cache-Control: no-cache, no-store, max-age=0, must-revalidate');
header('Expires: Mon, 12 Jul 1996 04:11:00 GMT'); //Any date passed.
header('Pragma: no-cache');

session_start();

if(isset($_SESSION['attempttest'])==1)
 {
  $_SESSION['attempttest']=0;
  if(isset($_SESSION['test_in_progress'])==1)
   {
     header("Location: ./taketest.php?resume='yes'");
     exit;
   }
require_once('../db.php');
require_once('student_functions.php');
list($name , $max_marks , $time_limit , $no_of_questions, $pass_marks,
     $negative_marks ,$marks) = get_quiz_details($connection,$_POST['quizid']);
$_SESSION['quizid']=$_POST['quizid'];
$_SESSION['qname']=$name;
$_SESSION['max_marks']=(int)$max_marks;
$_SESSION['time_limit']=(int)$time_limit;
$_SESSION['no_of_questions']=(int)$no_of_questions;
$_SESSION['pass_marks']=(int)$pass_marks;
$_SESSION['negative_marks']=(int)$negative_marks;
$_SESSION['marks']=(int)$marks;
$_SESSION['test_in_progress']=1;

$sql="SELECT Question_id FROM Qrelates WHERE Quiz_id=".$_POST['quizid']
      ." ORDER BY RAND()";
$query=mysql_query($sql,$connection);
$i=0;
while($row=mysql_fetch_array($query,MYSQL_NUM))   {
		  $questions[]=$row[0];
		  $answers[]=0;
		  $selected_answer[]=0;
		  $submit[]=0;
	      $i++;
		}
	$_SESSION['max_index']=$i;
	$_SESSION['index']=0;
	for($i=0;$i<$_SESSION['max_index'];$i++)
	   {
	     $sql_answer="SELECT correct_answer FROM Question WHERE id=".$questions[$i];
		 $query_answer=mysql_query($sql_answer,$connection);
		 $row_answer=mysql_fetch_array($query_answer,MYSQL_NUM);
		 $correct_answers[$i]=$row_answer[0];
		}
	$_SESSION['questions']=$questions;
	$_SESSION['correct_answers']=$correct_answers;
	$_SESSION['answers']=$answers;
	$_SESSION['selected_answers']=$selected_answer;
	$_SESSION['submit_values']=$submit;
    $_SESSION['time']=time()+($_SESSION['time_limit']*60); 	
	$_SESSION['start_index']=0;
	$_SESSION['end_index']=10;
	$_SESSION['loaded']=1;
	
	?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<title>
Quiz(Beta) -<?php echo $_SESSION['name'] ?> - You are about to attemp this Quiz !
</title>

<!-- Meta Tags -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- CSS -->
<?php include('../stylesheets.php') ?>

<!-- JavaScript -->
<?php include('../scripts.php') ?>
</head>

<body >
 <div class="main_container">
    <?php include('../header.php') ?>
     <div id="left" style=" font-size:14px"><b><form action="taketest.php" method="POST"><input type="Submit" name="Start" value="Start"></form></b></div>
    <div id="right" style="font-size:14px"><b><form action="studentlogin.php" method="POST"><input type="Submit" name="Cancel" value="Cancel"></form></b></div>

	<br><br>
    <h3>You are about to start this Quiz !   Please read the following instructions carefully.</h3>
	<br />
    <br />
    <h5>General Instructions</h5>
<div>  
    <ul style=" font-size:12px;" type="square">
	  <li>&bull; Do not use calculators, log tables, dictionaries, or any printed/online material while taking the quiz.</li>
	  <li>&bull;You can use rough paper for doing paper work.</li>
      <li>&bull;There will be objective questions having four choices , out of which only one is correct.</li>
    </ul>
    <br />
    <h5>While taking this Quiz</h5>
     <ul style=" font-size:12px;" type="square">  
	  <li>&bull;Please do not close your browser window during the quiz. If you do so your quiz will not be saved.</li>
      <li>&bull;Time given to attempt this quiz: <?php echo $_SESSION['time_limit'] ?> Minutes.</li>
	  <li>&bull;Once started, the quiz cannot be paused. Remaining time is displayed on the top of the page.</li>
      <li>&bull;At a time only one question is displayed on the page</li>
      <li>&bull;Radio buttons are provided to mark your answer.</li>
      <li>&bull;You can switch questions using the <b>PREVIOUS</b> and <b>NEXT</b> buttons.</li>
      <li>&bull;You can also navigate to the desired question by clicking the question number in the bar displayed at the bottom of the page</li>
      <li>&bull;You have to submit your answer for each question. A <b>Submit</b> button is provided for each question</li>
      <li>&bull;The correct answer and the status of your answer will be shown after you submit your answer</li>
      <li>&bull;Make Sure that you mark the correct option. After clicking the <b>Submit</b> button you will not be able to change your answer</li>
      <li>&bull;The question bar at the bottom of the page displays 10 questions at a time. To Switch to next or previous question-set use the <b><<</b> and <b>>></b> buttons.</li>
      <li>&bull;The stars beside each question link shows the status of the question</li>
           <li><ol type="1">
             <li>&bull;<img src="../images/none.gif" /> This shows that you have not yet attempted the question.</li>
             <li>&bull;<img src="../images/selected.gif" /> This shows that you have marked this question but not yet submitted your final answer</li>
             <li>&bull;<img  src="../images/submitted.gif" /> This shows that you have submitted your final answer for this questions.</li>
           </ol></li>
	  <li>&bull;Once the test time is over, the test will auto submit itself. Only those answer will be submitted which you have submitted. if yu have marked an option but did not clicked on <b>submit</b> your answer will not be considered.</li>
      <li>&bull;If you want to submit your test then click the <b>Submit my test</b> button</li>
      <li>&bull;If your test gets interrupted due to connectivity problems, please contact the lab administrator.</li>
    </ul>
</div>
<?php include('../footer.php') ?>
</div>
</body>
</html>
<?php } ?>
