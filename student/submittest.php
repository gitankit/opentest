<?php
session_start();
header('Cache-Control: no-cache, no-store, max-age=0, must-revalidate');
header('Expires: Mon, 12 Jul 1996 04:11:00 GMT'); //Any date passed.
header('Pragma: no-cache');

require_once('../db.php');
for($i=0;$i<$_SESSION['max_index'];$i++)
	   {
	    if($_SESSION['submit_values'][$i]==1)
		  {
		    $attempted_count=$attempted_count + 1 ;
		    if($_SESSION['answers'][$i]==$_SESSION['correct_answers'][$i])
               {
			    $correct_count=$correct_count + 1;
               }
            else if($_SESSION['answers'][$i]!=$_SESSION['correct_answers'][$i])
               {
                 $incorrect_count=$incorrect_count + 1;
               }
          }
	   }	  
 $score=($correct_count * $_SESSION['marks']) - ($incorrect_count * $_SESSION['negative_marks']);
 if($score < $_SESSION['pass_marks'])
    {
	  $result="Fail";
	}
  else
     {
	   $result="Pass";
	 }	   
$percentage=round((($score/$_SESSION['max_marks'])*100),2);	 
 $date=date("Y-m-d");
$sql="UPDATE Result set Score=".$score." , Attempt_date='".$date."'
       where Quiz_id=".$_SESSION['quizid']." and Roll_no=".$_SESSION['rollno'];
echo $sql;
$query=mysql_query($sql,$connection)
 or die (mysql_error());

mysql_close($connection);	 
 
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<title>
Quiz(Beta) - <?php echo $_SESSION['name'] ?> - Quiz Results
</title>

<!-- Meta Tags -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- CSS -->
<?php include('../stylesheets.php') ?>

<!-- JavaScript -->
<?php include('../scripts.php') ?>
</head>

<body >	   
 <div class="main_container"> 
  <?php include('../header.php') ?>
	     <table style="float:left">
		   <thead><tr>
		     <th>Quiz Name</th><th>Time Alloted</th><th>Max Marks</th><th>Pass Marks</th><th>Your Score</th><th>Percentage</th><th>Status</th></tr>
		   </thead>
           <tbody>
            <tr>
<?php
echo '<td>'.$_SESSION['qname'].'</td> 			
      <td>'.$_SESSION['time_limit'].'</td>
      <td>'.$_SESSION['max_marks'].'</td>
      <td>'.$_SESSION['pass_marks'].'</td>
      <td>'.$score.'</td>
	  <td>'.$percentage.'</td>
      <td>'.$result.'</td>';
	  
?>
       </tr>	  
 	   </tbody>
	   </table>
	   
       <table style="float:left">
         <thead>
           <tr><th>Total Questions</th><th>Attempted</th><th>Correct</th><th>Incorrect</th></tr>
         </thead>
         <tbody>
           <tr><td><?php echo $_SESSION['no_of_questions'] ?></td>
               <td><?php echo $attempted_count ?></td>
               <td><?php echo $correct_count ?></td>
               <td><?php echo $incorrect_count ?></td>  
            </tr>
          </tbody>
        </table>       
<?php
      unset($_SESSION['quizid']);
      unset($_SESSION['qname']);
      unset($_SESSION['time_limit']);
      unset($_SESSION['max_marks']);
      unset($_SESSION['no_of_questions']);
      unset($_SESSION['submit_values']);
      unset($_SESSION['correct_answers']);
      unset($_SESSION['answers']);
      unset($_SESSION['selected_answers']);
      unset($_SESSION['time']);
      unset($_SESSION['negative_marks']);
      unset($_SESSION['pass_marks']);
      unset($_SESSION['marks']);
      unset($_SESSION['start_index']);
	  unset($_SESSION['end_index']);
      unset($_SESSION['loaded']);
	  unset($_SESSION['max_index']);
	  unset($_SESSION['index']);
	  unset($_SESSION['questions']);
          unset($_SESSION['test_in_progress']);
	  
?>	    
<b><a style=" font-size:12px" href="studentlogin.php">Continue</a></b>
<?php include('../footer.php') ?>
</div>
</body>
</html>
