<?php
/* 
 * Display Available Quiz to Student 
 * 
 *@package Quiz
 *@Subpackage Student
 *@author Ankit Sharma findme.ankit@gmail.com
 *@param MySql Connection , Student Roll no  
 */
function get_student_quiz_info($connection,$username)
   {
     $sql="SELECT * FROM Result WHERE Roll_no=".$username;
     $query=mysql_query($sql,$connection);
     $count=1;
     while($row=mysql_fetch_array($query,MYSQL_NUM))
       {
         if($row[3]==NULL)
	   {
	    $sql_quizinfo="SELECT * FROM Quiz where id=".$row[1];
            $query_quizinfo=mysql_query($sql_quizinfo,$connection);
            $row_quizinfo=mysql_fetch_array($query_quizinfo,MYSQL_NUM);
            if($row_quizinfo[6]==0)
	      {
	       echo"<tr>
                    <td><span>".$count++."</span></td>
                    <td><span >".$row_quizinfo[1]."</span></td>
                    <td><span >".$row_quizinfo[2]."</span></td>
                    <td><span >".$row_quizinfo[7]."</span></td>
                    <td><span >".$row_quizinfo[9]."</span></td>
                    <td><span >".$row_quizinfo[10]."</span></td>
                    <td><span >".$row_quizinfo[3]."</span></td>
                    <td><span >".$row_quizinfo[4].'</span></td>
                    <form action="attempttest.php" method="POST">
	            <td>
                     <span>
                      <input type="hidden" name="quizid" value='.$row_quizinfo[0].'>
		      <button type="Submit" name="attempt">
                       <img src="../images/attempt.gif" name="attempt" value="Submit" title="Attempt this Quiz">
                      </button>
                     </span>
                    </td>
                   </form>
		  </tr>';
              }
          }
      }	  
 }
 

/* 
 * Password Validation for Student 
 * 
 *@package Quiz
 *@Subpackage Student
 *@author Ankit Sharma findme.ankit@gmail.com
 *@param MySql Connection , Current password , New Password , Confirm Password  
 *@return 0->Success , 1->Password contains spaces , 2->Length is less than 6 ,
 *3->New Password and Confirm Password Do not match , 4->Current Password do not match
 */
function validate_student($connection,$username,$old_password,$new_password,$confirm_password)
   {
    $sql="SELECT password from Student where Roll_no=".$username;
    $query=mysql_query($sql,$connection);
    $row=mysql_fetch_array($query,MYSQL_ASSOC);
    if(strcmp($row['password'],$old_password)==0)
      {
       if(strcmp($new_password,$confirm_password)==0)
        {
	 if(strlen($new_password)>=6)
	  {
	   if(!ereg(". ",$new_password))
	    {
             $ret_val=0;
	    }
	   else
	    {
	     $ret_val=1;
	    }
	  }
	 else
	  {
	   $ret_val=2;
	  }
	}
      else
	{
	 $ret_val=3;
	}
    }
   else
    {
     $ret_val=4;
    }
  return $ret_val;
 }


/* 
 * Change Password 
 * 
 *@package Quiz
 *@Subpackage Student
 *@author Ankit Sharma findme.ankit@gmail.com
 *@param MySql Connection , Student Roll no , New Password
 *@return 0 on Success , 1 on Failure  
 */
function change_password($connection,$username,$new_password)
   {
     $ret_val=1;
     $sql="UPDATE Student set password='".$new_password."' where Roll_no=".$username;
     $query=mysql_query($sql,$connection);
     if($query)
      {
           $ret_val=0;
      }
     return $ret_val;
    }
 

/* 
 * Display Attempted Quiz Details 
 * 
 *@package Quiz
 *@Subpackage Student
 *@author Ankit Sharma findme.ankit@gmail.com
 *@param MySql Connection , Student Roll no  
 */
function get_previous_test_detail($connection,$studentid)
    {
	 $sql="SELECT * FROM Result WHERE Roll_no=".$studentid;
	 $query=mysql_query($sql,$connection);
	 $count=1;
	 while($row=mysql_fetch_array($query,MYSQL_NUM))
	   {
            if($row[3]!=NULL)
              {
               $sql_quiz="SELECT * FROM Quiz WHERE id=".$row[1];
	       $query_quiz=mysql_query($sql_quiz,$connection);
               $row_quiz=mysql_fetch_array($query_quiz,MYSQL_NUM);
	       $percentage=round((((int)$row[2]/(int)$row_quiz[2])*100),2);
	       if((int)$row[2]>=(int)$row_quiz[7])
		    {
			  $status="Pass";
			}
		  else
		    {
			  $status="Fail";
			}
						  
		 echo '<tr>
			   <td>'.$count++.'</td>
			   <td>'.$row_quiz[1].'</td>
			   <td>'.$row_quiz[2].'</td>
			   <td>'.$row_quiz[7].'</td>
			   <td>'.$row[2].'</td>
			   <td>'.$percentage.'</td>
			   <td>'.$status.'</td>
			   <td>'.$row[3].'</td>
			   </tr>';
                 }
       }
    }	   
		
/* 
 * Get Quiz Details 
 * 
 *@package Quiz
 *@Subpackage Student
 *@author Ankit Sharma findme.ankit@gmail.com
 *@param MySql Connection , Quiz id  
 *@return 
 */
function get_quiz_details($connection,$quizid)
    {
      $sql="SELECT * FROM Quiz WHERE id=".$quizid;
      $query=mysql_query($sql,$connection);
      $row=mysql_fetch_array($query,MYSQL_NUM);
      return array($row[1] , $row[2] , $row[3] , $row[4] , $row[7] ,$row[9] , $row[10]);
    }


?>
