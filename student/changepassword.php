<?php
header('Cache-Control: no-cache, no-store, max-age=0, must-revalidate');
header('Expires: Mon, 12 Jul 1996 04:11:00 GMT'); //Any date passed.
header('Pragma: no-cache');

session_start();
require_once('../db.php');
require_once('student_functions.php');
if(isset($_POST['Submit']))
  {
    $val=validate_student($connection,$_SESSION['rollno'],$_POST['old_password'],
                          $_POST['new_password'],$_POST['confirm_password'] );
    if($val==0)
      {
       $result=change_password($connection,$_SESSION['rollno'],$_POST['new_password']);
       if($result==0)
	 {
	  $message="Password Changed Successfully";
	 }
       else if($result==1)
	 {
	  $error="Unable to Change Password";
	 }
      }
    else
      {
       switch($val)
        {
	 case 1:
	        $error=$error." No Special Characters other than '-' are allowed.";
	                 	 break;
         case 2:
	        $error=$error." Password length should be between 6-10.";
				 break;
	 case 3:
	        $error=$error." Your Password and Confirm Password Do Not Match.";
				 break;
	 case 4:
	        $error=$error." Your Current Password Do Not Match.";
				 break;
        }
     }
  }
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>
Quiz(Beta) - <?php echo $_SESSION['name'] ?> - Change Password
</title>

<!-- Meta Tags -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- CSS -->
<?php include('../stylesheets.php') ?>

<!-- JavaScript -->
<?php include('../scripts.php') ?>
<link rel="stylesheet" href="../css/forms.css" type="text/css" />

</head>

<body >

<div class="main_container">

<?php include('../header.php')  ?>



<div style="font-size:14px">
        <div id="left" ><b>Name :</b> <?php echo $_SESSION['name'] ?> </div>
        <div id="mid" ><b>Roll No :</b> <?php echo $_SESSION['rollno'] ?>  </div>
        <div id="right" ><b>Semester :</b> <?php echo $_SESSION['sem'] ?></div>
</div>

	<div id="nav_menu">
		<ul id="menu">
			<li id="home" class="first"><a href="studentlogin.php" title="Takes you to your home page"><b>Home</b></a></li>
			<li id="dropline"><a href="myprofile.php" title="View your profile"><b>My Profile</b></a></li>
			<li id="dropline"><a href="previoustest.php" title="View attempted quiz details"><b>Attempted Quiz</b></a></li>
			<li id="flyout"><a href="changepassword.php" title="Change your current password"><b>Change Password</b></a></li>
			<li id="support"><a href="logout.php" title="Logout from this system"><b>Logout</b></a></li>
		</ul>
	</div>


<div id="wrapper">
  <div class="form-container">
    <form   autocomplete="off"     enctype="multipart/form-data"  action="changepassword.php" method="POST"  >

 <?php if(isset($message)) { echo '<div  class="box green">'.$message.'</div>'; } ?>
 <?php if(isset($error)) { echo '<div  class="box red">'.$error.'</div>'; } ?>

	<p class="legend"><strong>Note:</strong> Required fields are marked with an asterisk (<em>*</em>)</p>
	
	<fieldset>
		<legend>Change Password</legend>
			<div><label <?php if($val==4) { echo 'class="error"'; } ?>for="uname" >Current Password <em>*</em></label> <input <?php if($val==4) { echo 'class="error"'; } ?>id="uname" type="password" value="<?php if($val!=0 && isset($_POST['old_password'])) { echo $_POST['old_password'];} ?>" name="old_password"   /></div>
			<div><label <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?>for="email">New Password <em>*</em></label> <input <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?>id="email" type="password" name="new_password"  value="" />
			</div>
			<div><label <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?>for="uname" >Confirm New Password <em>*</em></label> <input <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?>id="uname" type="password" value="" name="confirm_password"   /></div>
	</fieldset>
	<div class="buttonrow">
		<input type="submit" name="Submit" value="Change"  />
	</div>
</form> 
</div>    
</div>




<hr />	
<?php include('../footer.php') ?>
</div>

</body>
</html>

