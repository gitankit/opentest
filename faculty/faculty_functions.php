<?php
/* 
 * Display Quiz Created By Faculty
 *
 * @author Ankit Sharma findme.ankit@gmail.com
 * @package Quiz
 * @subpackage Faculty
 * @param MySql Connection , Faculty id
 */
function get_faculty_quiz_info($connection,$username)
 {

    $sql="SELECT * FROM Quiz WHERE Faculty_id='".$username."'";
    $query=mysql_query($sql,$connection);
    while($row_quizinfo=mysql_fetch_array($query,MYSQL_NUM))
     {
         echo"<tr>";
         echo '<td>';
          if($row_quizinfo[6]==0)
           {
               echo '<img src="../images/radio_enabled.gif" title="Enabled">';
           }
          else
           {
               echo '<img src="../images/radio_disabled.gif" title="Disabled">';
           }
           echo "</td>";
           echo '<form action="generatereport.php" method="POST" >
                 <td>
                  <span>
		   <input type="hidden" name="quizid"
                     value='.$row_quizinfo[0].'>
		   <input type="image" src="../images/report.gif" 
                     value="Submit" title="Generate Report for this Quiz">
                  </span>
                 </td>
                </form>';
           echo '<form action="edittest.php" method="POST">
                 <td>
                  <span>'.$row_quizinfo[1].
                   '<input type="hidden" name="quizid"
                      value='.$row_quizinfo[0].'>
		    <input type="image" src="../images/edit.gif" name="edit"
                      value="Submit" title="Edit this Quiz">
                  </span>
                 </td>
                </form>';
           echo "<td><span >".$row_quizinfo[2]."</span></td>";
           echo "<td><span >".$row_quizinfo[3]."</span></td>";
           echo "<td><span >".$row_quizinfo[4]."</span></td>";
           echo "<td><span >".$row_quizinfo[5]."</span></td>";
           echo '<td>
                  <form action="addstudent.php" method="POST">
                  <input type="hidden" name="quizid"
                    value='.$row_quizinfo[0].'>
                  <input type="image" src="../images/student_addremove.gif"
                    name="Submit" value="Submit"
                    title="Add/Remove Students from this Quiz">
                  </form>
                </td>';
           echo '<td>
                  <form action="addquestion.php" method="POST">
                  <input type="hidden" name="quizid"
                    value='.$row_quizinfo[0].'>
                  <input type="image" src="../images/student_addremove.gif"
                    name="q_add" value="Submit"
                    title="Add/Remove Questions from this Quiz">
                  </form>
                </td>';
          echo '<td>
                 <form action="facultylogin.php" method="POST">
                 <input type="hidden" name="quizid"
                   value='.$row_quizinfo[0].'>';
          echo '<BUTTON name="delete" type="Submit" style="background:"
                  style="border:none">
                <input type="image">
                <img src="../images/delete.gif"  title="Delete this Quiz">
                </form>
               </td>';
          echo '<td>
                 <form action="facultylogin.php" method="POST">
                 <input type="hidden" name="quizid"
                   value='.$row_quizinfo[0].'>';
          echo '<BUTTON name="enable" type="Submit" style="background:"
                 style="border:none">
                <img src="../images/enable.gif"
                  title="Allow Students to attempt this Quiz">
                </form>
               </td>';
         echo '<form  action="facultylogin.php" method="POST">
                <input type="hidden" name="quizid" value='.$row_quizinfo[0].'>
                <td>
                 <BUTTON name="disable" type="Submit"  style="background:"
                   style="border:none"><img src="../images/disable.gif"
                   name="disable" value="Submit"
                   title="Do Not Allow Students to attempt this quiz">
                </td>
               </form>';
           echo "</tr>";

     }
     
 }

function enable_quiz($connection,$id)
 {
      $ret_val=1;
      $sql="UPDATE Quiz SET enabled=0 WHERE id=".$id;
      $query=mysql_query($sql,$connection);
      if(mysql_affected_rows()==1)
       {
         $ret_val=0;
       }
      return $ret_val;
 }


function disable_quiz($connection,$id)
 {
      $ret_val=1;
      $sql="UPDATE Quiz SET enabled=1 WHERE id=".$id;
      $query=mysql_query($sql,$connection);
      if(mysql_affected_rows()==1)
       {
         $ret_val=0;
       }
      return $ret_val;
 }


function delete_quiz($connection,$id)
  {
      $ret_val=1;
      $sql="DELETE FROM Quiz , Qrelates , Result USING Quiz INNER JOIN Qrelates
             INNER JOIN Result ON Quiz.id=Qrelates.Quiz_id AND Quiz.id=Result.Quiz_id
             WHERE Quiz.id=".$id;
      $query=mysql_query($sql,$connection)
       or die(mysql_error());
      if($query)
        {
         $ret_val=0;
        }
  }


 function display_student($connection,$quizid)
   {
       $sql="SELECT * FROM Student_Info INNER JOIN Result ON
              Student_Info.Roll_no=Result.Roll_no WHERE Quiz_id=".$quizid;
       $query=mysql_query($sql,$connection);
       $count=1;
       while($row=mysql_fetch_array($query,MYSQL_ASSOC))
         {
           echo '<input type="hidden" name="studentid" value='.
                  $row['Roll_no'].'>';
           echo '<input type="hidden" name="quizid" value='.$quizid.'>';
           echo '<td><span><input type="checkbox" name="check[]" value='.
                 $row['Roll_no'].' title="Select to delete this student">
                 </span></td>';
           echo '<td><span>'.$count++.'</span></td>';
           echo "<td><span >".$row['Roll_no']."</span></td>";
           echo "<td><span >".$row['Firstname']." ".$row['Lastname'].
                 "</span></td>";
           echo "<td><span >".$row['Course']."</span></td>";
           echo "<td><span >".$row['Branch']."</span></td>";
           echo "<td><span >".$row['Semester']."</span></td>";
           echo "<td><span >".$row['Section']."</span></td>";
           echo '<input type="hidden" name="quizid" value='.$quizid.">";
           echo "</tr>";
         }
   }

function remove_student($connection,$quizid,$studentid)
  {
      $sql="DELETE FROM Result WHERE Roll_no='".$studentid."'
             AND Quiz_id=".$quizid;
      $query=mysql_query($sql,$connection);
  }

  
function validate_user($connection,$username,$old_password,$new_password,
                         $confirm_password)
{
    $sql="SELECT id , password FROM Faculty WHERE id=".$username;
    $query=mysql_query($sql,$connection);
    $row=mysql_fetch_array($query,MYSQL_ASSOC);
    if(strcmp($row['password'],$old_password)==0)
      {
       if(strcmp($new_password,$confirm_password)==0)
        {
	 if(strlen($new_password)>=6)
	  {
	   if(!ereg(". ",$new_password))
	    {
             $ret_val=0;
	    }
	   else
	    {
	     $ret_val=1;
	    }
	  }
	 else
	  {
	   $ret_val=2;
	  }
	}
      else
	{
	 $ret_val=3;
	}
    }
   else
    {
     $ret_val=4;
    }
return $ret_val;
}

function change_password($connection,$username,$new_password)
 {
     $ret_val=1;
     $sql="UPDATE Faculty SET password='".$new_password."' WHERE
            id=".$username;
    mysql_query($sql,$connection);
     if(mysql_affected_rows()==1)
      {
           $ret_val=0;
      }
     return $ret_val;
 }

function validate_user_in_test($connection,$username,$quizid)
{
    $ret_val=1;
    $sql="SELECT Roll_no FROM Result WHERE Roll_no='".$username."'
            AND Quiz_id=".$quizid;
    $query=mysql_query($sql,$connection);
    $row=mysql_fetch_array($query,MYSQL_ASSOC);
    if(strcasecmp($row['Roll_no'],$username)==0)
            {
                $ret_val=0;
            }

      return $ret_val;
}

function add_student($connection,$studentid,$quizid)
  {
      $sql_add="INSERT INTO Result VALUES
                ('".$studentid."',".$quizid.",NULL,NULL)";
      if(validate_user_in_test($connection,$studentid,$quizid)==1)
              {
                $query_add=mysql_query($sql_add,$connection);
              }
 }


 function display_question($connection,$quizid)
   {
       $sql="SELECT * FROM Question INNER JOIN Qrelates
              ON Question.id=Qrelates.Question_id WHERE Quiz_id=".$quizid;
       $query=mysql_query($sql,$connection);
       $count=1;
       while($row=mysql_fetch_array($query,MYSQL_ASSOC))
         {
             echo "<tr>";
             echo '<td>
                    <span>
                     <input type="checkbox" name="check[]" value='.
                       $row['id'].' title="Select to delete this question">
                    </span>
                   </td>';
	     echo '<td><span>'.$count++.'</td></span>';
             echo "<td><span >".$row['question']."</span></td>";
             echo "<td><span >".$row['op1']."</span></td>";
             echo "<td><span >".$row['op2']."</span></td>";
             echo "<td><span >".$row['op3']."</span></td>";
             echo "<td><span >".$row['op4']."</span></td>";
             switch($row['correct_answer'])
              {
                  case 1:
                      $answer=$row['op1'];
                      break;
                  case 2:
                      $answer=$row['op2'];
                      break;
                  case 3:
                      $answer=$row['op3'];
                      break;
                  case 4:
                      $answer=$row['op4'];
                      break;
              }
             echo "<td><span >".$answer."</span></td>";
             echo '<input type="hidden" name="quizid" value='.$quizid.'>';
             echo "</tr>";

         }
   }

function check_question_duplicacy($connection,$quizid,$questionid)
{
    $ret_val=1;
    $sql="SELECT Question_id FROM Qrelates WHERE Quiz_id=".$quizid."
           AND Question_id=".$questionid;
    $query=mysql_query($sql,$connection);
    $row=mysql_fetch_array($query,MYSQL_ASSOC);
    if($row['Question_id']==$questionid )
            {
                $ret_val=0;
            }
   return $ret_val;
}

function add_question_from_database($connection,$quizid,$questionid)
   {
       $sql="INSERT INTO Qrelates VALUES(".$quizid.",".$questionid.")";
       if(check_question_duplicacy($connection,$quizid,$questionid)==1)
         {
            $query=mysql_query($sql,$connection);
            update_no_of_questions($connection,$quizid,"add");
         }
   }

function display_questions_from_database($connection,$quizid,$keyword)
     {
         $sql="SELECT * FROM Question WHERE keyword='".$keyword."'";
         $query=mysql_query($sql,$connection);
         echo '<div >';
         echo '<table style=" float:left">';
         echo '<form name="database_questions_form" action="addquestion.php"
                 method="POST">';
         echo '<thead>';
         echo '<tr>
                <th>
                 <input type="checkbox" name="Check_ctr" value="yes"
                   onClick="Check4()" title="Select/Desecelt All">
                </th>
                <th>S.No</th>
                <th>Question</th>
                <th>Option 1</th>
                <th>Option 2</th>
                <th>Option 3</th>
                <th>Option 4</th>
                <th>Correct Answer</th>
                <td>
                 <input type="Submit" name="addquestion" value="Add"
                   title="Click to add selected questions">
                </td>
              </tr>';
         echo '</thead>';
         echo '<tbody>';
	 $count=1;
         while($row=mysql_fetch_array($query,MYSQL_ASSOC))
          {
           echo '<tr>';
           echo '<td>
                  <input type="checkbox" name="check[]" value='.$row['id'].'
                    title="Select to add this question">
                 </td>';
           echo '<td>'.$count++.'</td>';
           echo '<td>'.$row['question'].'</td>';
           echo '<td>'.$row['op1'].'</td>';
           echo '<td>'.$row['op2'].'</td>';
           echo '<td>'.$row['op3'].'</td>';
           echo '<td>'.$row['op4'].'</td>';
           switch($row['correct_answer'])
              {
                  case 1:
                      $answer=$row['op1'];
                      break;
                  case 2:
                      $answer=$row['op2'];
                      break;
                  case 3:
                      $answer=$row['op3'];
                      break;
                  case 4:
                      $answer=$row['op4'];
                      break;
              }
		   
           echo '<td>'.$answer.'</td>';
           echo '</tr>';
      }
           echo '</tbody>';
           echo '<input type="hidden" name="quizid" value='.$quizid.' >';
           echo '</form>';
           echo '</table>';
           echo '</div>';
     
 }



function update_no_of_questions($connection,$quizid,$add_delete)
  {
      
      $sql="SELECT no_of_questions FROM Quiz WHERE id=".$quizid;
      $query=mysql_query($sql,$connection);
      $row=mysql_fetch_array($query,MYSQL_ASSOC);
      $a=(int) $row['no_of_questions'];
      switch($add_delete)
       {
           case "add":
               $questions =$a + 1;
               break;
           case "delete":
               $questions =$a - 1;
               break;               
       }
      $sql_update="UPDATE Quiz SET no_of_questions=".$questions."
                    WHERE id=".$quizid;
      $query_update=mysql_query($sql_update,$connection);
  }


 function delete_question($connection,$quizid,$questionid)
   {
       $sql="DELETE FROM Qrelates WHERE Quiz_id=".$quizid."
               AND Question_id=".$questionid;
       $query=mysql_query($sql,$connection);
       update_no_of_questions($connection,$quizid,"delete");
   }

  

 function create_test($connection,$userid,$name,$time_limit,$enabled,
                       $passmarks,$maxmarks,$negative_marks,
                         $marks_for_each_question)
   {
       if(!$negative_marks)
         {
          $negative_marks=0;
         }
       $ret_val=1;
       $date=date("Y-m-d");
       $sql_quiz="INSERT INTO Quiz (name ,max_marks ,time_limit ,
                   no_of_questions ,date_created ,enabled ,pass_marks ,
                   Faculty_id ,negative_mark ,mark) VALUES('".$name."',".
                   $maxmarks.",".$time_limit.",0,'".$date."',".$enabled.",".
                   $passmarks.",'".$userid."',".$negative_marks.",".
                   $marks_for_each_question.")";
       echo $sql_quiz;
       $query_quiz=mysql_query($sql_quiz,$connection)
         or die(mysql_error());
       if(mysql_affected_rows()==1)
        {
         $ret_val=0;
	}
       return $ret_val;
   }

function edit_test($connection,$quizid,$name,$time_limit,$max_marks,
                    $pass_marks,$negative_marks,$marks_for_each_question)
   {
     $ret_val=1;
     $sql="UPDATE Quiz SET name='".$name."' , max_marks=".$max_marks." ,
            time_limit=".$time_limit." , pass_marks=".$pass_marks." ,
            negative_mark=".$negative_marks." , mark=".$marks_for_each_question.
             " WHERE id=".$quizid;
	 $query=mysql_query($sql,$connection);
	 if(mysql_affected_rows()==1)
	   {
	     $ret_val=0;
	   }
	 return $ret_val;
   }
   
   

function generate_test_report($connection,$quizid)
  {
      $not_appeared_count=0;
      $fail_count=0;
      $pass_count=0;
      $count=0;
      $sql_quiz="SELECT name , max_marks ,pass_marks , no_of_questions ,
                  time_limit , date_created  FROM Quiz WHERE id=".$quizid;
      $query_quiz=mysql_query($sql_quiz,$connection);
      $row_quiz=mysql_fetch_array($query_quiz,MYSQL_ASSOC);

      $sql="SELECT * from Result INNER JOIN Student_Info
             ON Result.Roll_no=Student_Info.Roll_no WHERE Quiz_id=".$quizid;
      $query=mysql_query($sql,$connection);
      while($row=mysql_fetch_array($query,MYSQL_ASSOC))
	   {
                ++$count;
                $student_rollno[$count]=$row['Roll_no'];
                $student_name[$count]=($row['Firstname']." ".$row['Lastname']);
                $student_branch[$count]=$row['Branch'];
                $student_course[$count]=$row['Course'];
                $student_sem[$count]=$row['Semester'];
                $student_sec[$count]=$row['Section'];
	        if($row['Attempt_date']==NULL)
                 {
                        $student_attempt_date[$count]="N A";
                        $student_marks_scored[$count]="N A";
                        $student_percentage[$count]="N A";
                        $student_status[$count]="N A";
                        $not_appeared_count++;
                 }
               else
                {
                        $student_attempt_date[$count]=$row['Attempt_date'];
                        $student_marks_scored[$count]=$row['Score'];
		        $percentage=(((int)$row['Score']/
                                        (int)$row_quiz['max_marks'])*100);
                        $student_percentage[$count]=$percentage;
         		$score=$row['Score'];
		        $pass_marks=$row_quiz['pass_marks'];
		        if($score<$pass_marks)
                        {
                           $student_status[$count]="Fail";
                           $fail_count++;
                        }
                       else
                        {
                         $student_status[$count]="Pass";
                         $pass_count++;
                        }
               }
            			   
        }

   echo '<table style="float:left">
          <thead>
           <tr>
	    <th>Quiz Name</th>
            <th>Max. marks</th>
            <th>Pass Marks</th>
            <th>No. of Questions</th>
            <th>Time Limit</th>
	    <th>Date Created</th>
            <th>Students Enrolled</th>
            <th>Students Appeared</th>
            <th>Students Passed</th>
            <th>Students Failed</th>
            <th>Faculty</th>
          </tr>
	</thead>
        <tbody>
	 <tr>
	  <td>'.$row_quiz['name'].'</td>
	  <td>'.$row_quiz['max_marks'].'</td>
	  <td>'.$row_quiz['pass_marks'].'</td>
	  <td>'.$row_quiz['no_of_questions'].'</td>
          <td>'.$row_quiz['time_limit'].'</td>
	  <td>'.$row_quiz['date_created'].'</td>
	  <td>'.$count.'</td>
          <td>'.($count-$not_appeared_count).'</td>
	  <td>'.$pass_count.'</td>
	  <td>'.$fail_count.'</td>
	  <td>'.$_SESSION['name'].'</td>
	</tr>
      </tbody>
   </table>';

  echo '<table style="float:left">
          <thead>
           <tr>
            <th>S.No</th>
            <th>Rollno</th>
            <th>Name</th>
            <th>Course</th>
            <th>Branch</th>
            <th>Semester</th>
            <th>Section</th>
            <th>Attempt Date</th>
            <th>Marks Scored</th>
            <th>Percentage</th>
            <th>Status</th>
          </tr>
         </thead>
         <tbody>';
           for($i=1;$i<=$count;$i++)
            {
             echo '<tr>
                   <td>'.$i.'</td>
                   <td>'.$student_rollno[$i].'</td>
                   <td>'.$student_name[$i].'</td>
                   <td>'.$student_course[$i].'</td>
                   <td>'.$student_branch[$i].'</td>
                   <td>'.$student_sem[$i].'</td>
                   <td>'.$student_sec[$i].'</td>
                   <td>'.$student_attempt_date[$i].'</td>
                   <td>'.$student_marks_scored[$i].'</td>
                   <td>'.$student_percentage[$i].'</td>
                   <td>'.$student_status[$i].'</td>
                   </tr>';
            }
echo '</tbody>
      </table>';
}
                   				   
function display_search_bar($connection,$quizid)					 
   {
     $sql="SELECT DISTINCT keyword FROM Question";
     $query=mysql_query($sql,$connection);
     echo '<table style=" float:left">
            <tbody>
             <tr><form action="'.$_SERVER['PHP_SELF'].' " method="POST">
              <td>
               <select name="keyword" title=""> ';
	        while($row=mysql_fetch_array($query,MYSQL_ASSOC))
	          {
		   echo '<option value='.$row['keyword'].'>'.$row['keyword'].
                          '</option>';
		  }
	        echo ' </select>
              </td>
              <td>
               <input type="hidden" name="quizid" value='.$quizid.'>
               <input type="Submit" name="Search" value="Search" 
                 title="Search Questions from Database">
              </td>
            </tr>
          </form>
         </tbody>
        </table>';
   }
	
function display_search_bar_student($connection,$quizid)
    {
	$sql_course="SELECT DISTINCT Course FROM Student_Info ORDER BY Course";
	$sql_branch="SELECT DISTINCT Branch FROM Student_Info ORDER BY Branch";
	$sql_sem="SELECT DISTINCT Sem FROM Student_Info ORDER BY Sem";
	$sql_sec="SELECT DISTINCT Sec FROM Student_Info ORDER BY Sec";
	$query_course=mysql_query($sql_course,$connection);
	$query_branch=mysql_query($sql_branch,$connection);
	$query_sec=mysql_query($sql_sec,$connection);
	$query_sem=mysql_query($sql_sem,$connection);
	echo '<tr><form action="addstudent.php" method="POST">';
	echo '<td><select name="course">';
	echo '<option value="NULL">Course</option>';
	while($row_course=mysql_fetch_array($query_course,MYSQL_ASSOC))
	   {
	     echo '<option value='.$row_course['Course'].'>'.
                    $row_course['Course'].'</option>';
	   }
	echo '</select></td>';
	echo '<td><select name="branch">';
	echo '<option value="NULL">Branch</option>';
	while($row_branch=mysql_fetch_array($query_branch,MYSQL_ASSOC))
	   {
	     echo '<option value='.$row_branch['Branch'].'>'.
                    $row_branch['Branch'].'</option>';
	   }
	echo '</select></td>';
	echo '<td><select name="Semester">';
	echo '<option value="NULL">Semester</option>';
	while($row_sem=mysql_fetch_array($query_sem,MYSQL_ASSOC))
	   {
	     echo '<option value='.$row_sem['Sem'].'>'.$row_sem['Sem'].
                    '</option>';
	   }
	echo '</select></td>';
	echo '<td><select name="Section">';
	echo '<option value="NULL">Section</option>';
	while($row_sec=mysql_fetch_array($query_sec,MYSQL_ASSOC))
	   {
	     echo '<option value='.$row_sec['Sec'].'>'.$row_sec['Sec'].
                    '</option>';
	   }
	echo '</select></td>';
	echo '<input type="hidden" name="quizid" value='.$quizid.'>
	      <td><input type="Submit" name="Search" value="Search" 
                    title="Click to Search Students">
              </td>
	     </form>
            </tr>';
  }

function display_search_bar_student_profile($connection)
    {
	$sql_course="SELECT DISTINCT Course FROM Student_Info ORDER BY Course";
	$sql_branch="SELECT DISTINCT Branch FROM Student_Info ORDER BY Branch";
	$sql_sem="SELECT DISTINCT Semester FROM Student_Info ORDER BY Semester";
	$sql_sec="SELECT DISTINCT Section FROM Student_Info ORDER BY Section";
	$query_course=mysql_query($sql_course,$connection);
	$query_branch=mysql_query($sql_branch,$connection);
	$query_sec=mysql_query($sql_sec,$connection);
	$query_sem=mysql_query($sql_sem,$connection);
	echo '<form action="studentprofile.php" method="POST">';
	echo '<td><select name="course">';
	echo '<option value="NULL">Course</option>';
	while($row_course=mysql_fetch_array($query_course,MYSQL_ASSOC))
	   {
	     echo '<option value='.$row_course['Course'].'>'.$row_course['Course'].
                     '</option>';
	   }
	echo '</select></td>';
	echo '<td><select name="branch">';
	echo '<option value="NULL">Branch</option>';
	while($row_branch=mysql_fetch_array($query_branch,MYSQL_ASSOC))
	   {
	     echo '<option value='.$row_branch['Branch'].'>'.
                    $row_branch['Branch'].'</option>';
	   }
	echo '</select></td>';
	echo '<td><select name="Semester">';
	echo '<option value="NULL">Semester</option>';
	while($row_sem=mysql_fetch_array($query_sem,MYSQL_ASSOC))
	   {
	     echo '<option value='.$row_sem['Semester'].'>'.$row_sem['Semester'].
                    '</option>';
	   }
	echo '</select></td>';
	echo '<td><select name="Section">';
	echo '<option value="NULL">Section</option>';
	while($row_sec=mysql_fetch_array($query_sec,MYSQL_ASSOC))
	   {
	     echo '<option value='.$row_sec['Section'].'>'.$row_sec['Section'].
                    '</option>';
	   }
	echo '</select></td>
	      <td><input type="text" name="student_rollno" maxlength="10"
                 title="Enter the roll number of the student"></td>';
	echo '<td>
               <input type="Submit" name="Search" value="Search"
                  title="Click to Search Student Profiles">
             </td>
            </form>';
 }

function display_search_result_student($connection,$quizid,$course,
                                         $branch,$sem,$sec)
   {
    if($sem!='NULL')
	  {
	    $sql="SELECT * FROM Student_Info WHERE Semester='".$sem."' ";
	  }
	if($course!='NULL')
	  {
	    if(isset($sql))
		   {
		    $sql=$sql." AND Course='".$course."' ";
		   }
		 else
		   {
    	    $sql="SELECT * FROM Student_Info WHERE Course='".$course."' ";
		   }
	  }
	if($branch!='NULL')
	  {
	    if(isset($sql))
		  {
		    $sql=$sql." AND Branch='".$branch."' ";
		  }
		 else
		  {
     	    $sql="SELECT * FROM Student_Info WHERE Branch='".$branch."' ";
	      }
     }
	if($sec!='NULL')
	  {
	    if(isset($sql))
		  {
		    $sql=$sql." AND Section='".$sec."' ";
		  }
		 else
		  {
     	    $sql="SELECT * FROM Student_Info WHERE Section='".$sec."' ";
	      }
     }
	 if(isset($sql))
	    {
		  $sql=$sql." ORDER BY Roll_no";
		}
	 $query=mysql_query($sql,$connection);
	 echo '<table style="float:left">
                <form name="search_result_student_form"
                   action="addstudent.php" method="POST">
	      <thead>
               <tr>
               <th>
                <input type="checkbox" name="Check_ctr" value="yes"
                  onClick="Check()" title="Select/Deselect All">
               </th>
               <th>S.No</th>
               <th>Roll No</th>
               <th>Name</th>
               <th>Course</th>
               <th>Branch</th>
               <th>Semester</th>
               <th>Section</th>
               <th><input type="Submit" name="add"
                    value="Add" title="Click to add selected students">
               </th>
               </tr>
	       </thead>
               <tbody>';
        $count=1;
        while($row=mysql_fetch_array($query,MYSQL_ASSOC))
	  {
	    echo '<tr>
		   <td>
                     <input type="checkbox" name="check[]"
                       value='.$row['Roll_no'].'
                         title="Select to add this student">
                   </td>
		   <td>'.$count++.'</td>
		   <td>'.$row['Roll_no'].'</td>
                   <td>'.$row['Firstname']." ".$row['Lastname'].'</td>
                   <td>'.$row['Course'].'</td>
		   <td>'.$row['Branch'].'</td>
		   <td>'.$row['Semester'].'</td>
		   <td>'.$row['Section'].'</td>
		  </tr>';
  	   
	   }
	echo '</tbody>
	       <input type="hidden" name="quizid" value='.$quizid.'>
              </form>
             </table>';
   }	  	



  function display_search_result_student_profile($connection,$course,
                                                  $branch,$sem,$sec)
   {
    if($sem!='NULL')
	  {
	    $sql="SELECT * FROM Student_Info WHERE Semester='".$sem."'";
	  }
	if($course!='NULL')
	  {
	    if(isset($sql))
	       {
	        $sql=$sql." AND Course='".$course."' ";
	       }
	    else
	      {
    	       $sql="SELECT * FROM Student_Info WHERE Course='".$course."' ";
	      }
	  }
	if($branch!='NULL')
	  {
	    if(isset($sql))
		  {
		    $sql=$sql." AND Branch='".$branch."' ";
		  }
		 else
		  {
     	    $sql="SELECT * FROM Student_Info WHERE Branch='".$branch."' ";
	      }
     }
	if($sec!='NULL')
	  {
	    if(isset($sql))
		  {
		    $sql=$sql." AND Section='".$sec."' ";
		  }
		 else
		  {
     	    $sql="SELECT * FROM Student_Info WHERE Section='".$sec."' ";
	      }
     }
	 if(isset($sql))
	    {
		  $sql=$sql." ORDER BY Roll_no";
	    }
	 $query=mysql_query($sql,$connection);
	 echo '<table style="float:left">	 
	        <thead>
                <tr>
                 <th>S.No</th>
                 <th>Roll No</th>
                 <th>Name</th>
                 <th>Course</th>
                 <th>Branch</th>
                 <th>Semester</th>
                 <th>Section</th>
                 <th></th>
                </tr>
		</thead>
                <tbody>	 ';
	$count=1;
        while($row=mysql_fetch_array($query,MYSQL_ASSOC))
    	 {
          echo '<tr>
                 <form  action="studentprofiledetails.php" method="POST">
   		 <td>'.$count++.'</td>
		 <td>'.$row['Roll_no'].
                   '<input type="hidden" name="studentrollno" value='.
                       $row['Roll_no'].'>
                 </td>
		 <input type="hidden" name="studentid" value='.
                   $row['Roll_no'].'>
                 <td>'.$row['Firstname']." ".$row['Lastname'].
                   '<input type="hidden" name="studentname"
                   value='.($row['Firstname']." ".$row['Lastname']).'</td>
  		 <td>'.$row['Course'].'<input type="hidden"
                        name="studentcourse" value='.$row['Course'].'>
                 </td>
		 <td>'.$row['Branch'].'<input type="hidden"
                        name="studentbranch" value='.$row['Branch'].'>
                 </td>
		 <td>'.$row['Semester'].'<input type="hidden" name="studentsem"
                         value='.$row['Semester'].'>
                 </td>
		 <td>'.$row['Section'].'<input type="hidden"
                        name="studentsec" value='.$row['Section'].'>
                 </td>
		 <td><input type="image" src="../images/attempt.gif"
                        value="Submit">
                 </td>
		 </form>
              </tr>';
  	    }
	echo '</tbody>
             </table>';
   }	  	

   function display_student_result_info($connection,$studentid)
    {
	  $sql="SELECT * FROM Result INNER JOIN Quiz ON
                        Result.Quiz_id=Quiz.id WHERE Roll_no='".$studentid."'";
	  $query=mysql_query($sql,$connection);
	  $count=1;
	  while($row=mysql_fetch_array($query,MYSQL_ASSOC))
	    {
		 if($row['Attempt_date']!=NULL)
		   {
		    echo '<tr>
                           <td>'.$count++.'</td>
		           <td>'.$row['name'].'</td>
  			   <td>'.$row['max_marks'].'</td>
			   <td>'.$row['pass_marks'].'</td>
			   <td>'.$row['Score'].'</td>';
			   $percentage=(((int)$row['Score']/
                                         (int)$row['max_marks'])*100);
		    echo ' <td>'.$percentage.'</td>';
		    if((int)$row['Score']>=(int)$row['pass_marks'])
		      {
		       $status="Pass";
		      }
		    else
		      {
		       $status="Fail";
		      }
                    echo ' <td>'.$status.'</td>
			   <td>'.$row['Attempt_date'].'</td>
                         </tr>';
		  }
	  }
    }  		

   ?>
