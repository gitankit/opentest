<?php
session_start();
require_once('../db.php');
require_once('faculty_functions.php');
if(isset($_POST['Submit']))
  {
	   $val=validate_user($connection,$_SESSION['id'],$_POST['old_password'],$_POST['new_password'],$_POST['confirm_password']);
	   if($val==0)
	     {
		   $result=change_password($connection,$_SESSION['id'],$_POST['new_password']);
		   if($result==0)
		     {
			  $message="Password Changed Successfully";
			 }
		   else if($result==1)
		     {
			  $error="Unable to Change Password";
			 }
		 }

	   else
	     {
		   switch($val)
		    {
			  case 1:
			         $error=$error." No Spaces are allowed.";
					 break;
			  case 2:
			         $error=$error." Password length should be between 6-10.";
					 break;
			  case 3:
			         $error=$error." Your Password and Confirm Password Do Not Match.";
					 break;
			  case 4:
			         $error=$error." Your Current Password Do Not Match.";
					 break;

		   }
        }
      }
   include('./header.php');
  ?>


<div id="wrapper">
  <div class="form-container">
    <form   autocomplete="off"     enctype="multipart/form-data"  action="changepassword.php" method="POST"  >

 <?php if(isset($message)) { echo '<div  class="box green">'.$message.'</div>'; } ?>
 <?php if(isset($error)) { echo '<div  class="box red">'.$error.'</div>'; } ?>

	<p class="legend"><strong>Note:</strong> Required fields are marked with an asterisk (<em>*</em>)</p>
	
	<fieldset>
		<legend>Change Password</legend>
			<div><label <?php if($val==4){ echo 'class="error"'; }?> for="uname" >Current Password <em>*</em></label> <input <?php if($val==4){ echo 'class="error"'; }?> id="uname" type="password" value="<?php if($val!=0 && isset($_POST['old_password'])) { echo $_POST['old_password'];} ?>" name="old_password"   /></div>
			<div><label <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?> for="email">New Password <em>*</em></label> <input <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?> id="email" type="password" name="new_password"  value="" />
			</div>
			<div><label <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?> for="uname" >Confirm New Password <em>*</em></label> <input <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?> id="uname" type="password" value="" name="confirm_password"   /></div>
	</fieldset>
	<div class="buttonrow">
		<input type="submit" name="Submit" value="Change"  />
	</div>
</form> 
</div>    
</div>
 
	
<?php include('../footer.php') ?>
</div>

</body>
</html>