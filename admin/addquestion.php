<?php 
    session_start();
    require_once('../db.php');
    require_once('admin_functions.php');
if(isset($_POST['Submit']))
   {
     $result=upload_questions($connection,$_FILES['filename']['tmp_name']);
	 if($result==0)
	   {
	    $message_upload="All questions uploaded successfully";
	   }
	 else if($result==1)
	    {
		 $error_upload="Cannot upload questions";
		}  	   
	 else
	   {
	     $error_upload="Only ".$result." questions were uploaded";
	   }
     
   }
if(isset($_POST['add']))
  {
    if(strlen($_POST['question'])>0)
     {
       if(strlen($_POST['option1'])>0)
        {
          if(strlen($_POST['option2'])>0)
           {
             if(strlen($_POST['option3'])>0)
              {
                if(strlen($_POST['option4'])>0)
                 {
                   if(strlen($_POST['keyword'])>0)
                    {
                     $result=add_new_question($connection,$_POST['question'],$_POST['option1'],$_POST['option2'],$_POST['option3'],$_POST['option4'],$_POST['correct_answer'],$_POST['keyword'],$_POST['level']);
                     if($result==0)
                      {
                        $message="Question Entered Successfully.";
                      }
                     else
                      {
                        $error="Unable to enter question";
                      }
                    }
                   else
                    {
                      $error=$error." Please enter keyword";
                    }
                 }
                else
                 {
                   $error=$error." Please enter Option 4";
                 }
              }
             else
              {
                 $error=$error." Please Enter Option 3";
              }
           }
          else
           {
             $error=$error." Please Enter Option 2";
           }
        }
       else
        {
            $error=$error." Please Enter Option 1";
        }
     }
    else
     {
         $error=$error." Please Enter Question";
     }
  }
      
   
?>    

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Quiz(Beta) - <?php echo $_SESSION['name'] ?> - Add Question</title>
<!-- CSS -->
<?php include('../stylesheets.php') ?>
<link rel="stylesheet" href="../css/forms.css" type="text/css" />

<!-- JavaScript -->
<?php include('../scripts.php') ?>
</head>
<body>
<div class="main_container">
<?php include('../header.php') ?>
<div style="font-size:14px">
        <div id="left" ><b>Name :</b><?php echo $_SESSION['name'] ?> </div>
        <div id="mid" ><b>Login ID :</b><?php echo $_SESSION['id'] ?></div>
        <div id="right" ><b>Department :</b><?php echo $_SESSION['department'] ?></div>
</div>

	<div id="nav_menu">
		<ul id="menu">
			<li id="home" class="first"><a href="adminlogin.php" title="Takes you to your home page"><b>Home</b></a></li>
			<li id="single"><a href="facultyadmin.php" title="View Faculty Details"><b>Faculty Search</b></a></li>
			<li id="home"><a href="studentadmin.php" title="View Student Details"><b>Student Search</b></a></li>
			<li id="dropline"><a href="myprofile.php" title="Your Profile"><b>My Profile</b></a></li>
			<li id="flyout"><a href="changepassword.php" title="Change your current password"><b>Change Password</b></a></li>
			<li id="support"><a href="logout.php" title="Logout from this system"><b>Logout</b></a></li>
		</ul>
	</div>
<div id="wrapper" style="float:left">
<div class="form-container">
<form  autocomplete="off" enctype="multipart/form-data"  action="<?php echo $_SESSION['PHP_SELF'] ?>" method="POST"  >
	
<?php if(isset($message_upload)) { echo '<div  class="box green">'.$message_upload.'</div>'; } ?>
<?php if(isset($error_upload)) {  echo  '<div  class="box red">'.$error_upload.'</div>';}  ?>
 
	
	<fieldset>
		<legend>Upload Questions(csv file)</legend>
			<div><label for="uname" >File </label> <input id="uname" type="file"  name="filename"   /></div>
    </fieldset>        
	<div class="buttonrow">
		<input type="submit" name="Submit" value="Upload"  />
	</div>
</form> 
</div>    
</div>
<div id="wrapper" style="float:left">
<div class="form-container">
<form  autocomplete="off" enctype="multipart/form-data"  action="<?php echo $_SESSION['PHP_SELF'] ?>" method="POST"  >
	
<?php if(isset($message)) { echo '<div  class="box green">'.$message.'</div>'; } ?>
<?php if(isset($error)) {  echo  '<div  class="box red">'.$error.'</div>';}  ?>
 
	<p class="legend"><strong>Note:</strong> Required fields are marked with an asterisk (<em>*</em>)</p>
	
	<fieldset>
		<legend>Question </legend>
			<div><label for="uname" >Question <em>*</em></label> <textarea id="uname"  name="question" rows="4" cols="50"></textarea></div>
       <fieldset>
         <legend>Options</legend>     
			<div><label for="email">Option 1 <em>*</em></label> <textarea id="email" name="option1" ></textarea></div>
			<div><label for="email">Option 2 <em>*</em></label> <textarea id="email" name="option2"></textarea></div>
			<div><label for="email">Option 3 <em>*</em></label> <textarea id="email" name="option3"></textarea></div>
			<div><label for="email">Option 4 <em>*</em></label> <textarea id="email" name="option4"></textarea></div>
       </fieldset>     
			<div>
				<label for="type">Correct Option <em>*</em></label>
				<select id="type" name="correct_answer">
                        <option  value="1">Option 1</option>
                        <option  value="2">Option 2</option>
                        <option  value="3">Option 3</option>
						<option  value="4">Option 4</option>
				</select>
			<div><label for="email">Keyword <em>*</em></label> <input id="email" type="text" name="keyword"  value="" /></div>
    	    <div><label for="email">Level </label> <input id="email" type="text" name="level"  value="" /></div>
			</div>
	</fieldset>
	<div class="buttonrow">
		<input type="submit" name="add" value="Save"  />
        <input type="reset" name="reset" value="Clear"  />
	</div>
</form> 
</div>    
</div>
<hr />
<?php include('../footer.php') ?>
</div>
</body>
</html>
