<?php
session_start();
require_once('../db.php');
require_once('admin_functions.php');
if(isset($_POST['Submit']))
  {
    if($_SESSION['admin_id']==1)
	  { 
	   $val=validate_password_system($connection,$_POST['old_password'],$_POST['new_password'],$_POST['confirm_password']);
	   if($val==0)
	     {
		   $result=change_password_system($connection,$_POST['new_password']);
		   if($result==0)
		     {
			  $message="Password Changed Successfully";
			 }
		   else if($result==1)
		     {
			  $error="Unable to Change Password";
			 } 
		 }
            else
               {
                   		   switch($val)
		    {
			  case 1:
			         $error=$error." Spaces are not allowed.";
					 break;
			  case 2:
			         $error=$error." Password length should be between 6-10.";
					 break;
			  case 3:
			         $error=$error." Your Password and Confirm Password Do Not Match.";
					 break;
			  case 4:
			         $error=$error." Your Current Password Do Not Match.";
					 break;

               }
          }
          }
     if($_SESSION['admin_id']==0)
         {
             $val=validate_password($connection,$_SESSION['id'],$_POST['old_password'],$_POST['new_password'],$_POST['confirm_password']);
	   if($val==0)
	     {
		   $result=change_password($connection,$_SESSION['id'],$_POST['new_password']);
		   if($result==0)
		     {
			  $message="Password Changed Successfully";
			 }
		   else if($result==1)
		     {
			  $error="Unable to Change Password";
			 }
		 }

         

	   else
	     {
		   switch($val)
		    {
			  case 1:
			         $error=$error." Spaces are not are allowed.";
					 break;
			  case 2:
			         $error=$error." Password length should be between 6-10.";
					 break;
			  case 3:
			         $error=$error." Your Password and Confirm Password Do Not Match.";
					 break;
			  case 4:
			         $error=$error." Your Current Password Do Not Match.";
					 break;
			         		 
		   }	          	 	 
        }
         }
      }
  
				
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<title>
Quiz(Beta) - <?php echo $_SESSION['name'] ?> - Change Password
</title>

<!-- Meta Tags -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- CSS -->
<?php include('../stylesheets.php')?>
<link rel="stylesheet" href="../css/forms.css" type="text/css" />

<!-- JavaScript -->
<?php include('../scripts.php') ?>
</head>

<body >
<div class="main_container">
<?php include('../header.php') ?>

<div style="font-size:14px">
        <div id="left" ><b>Name :</b><?php echo $_SESSION['name'] ?> </div>
        <div id="mid" ><b>Login ID :</b><?php echo $_SESSION['id'] ?></div>
        <div id="right" ><b>Department :</b><?php echo $_SESSION['department'] ?></div>
</div>


	<div id="nav_menu">
		<ul id="menu">
			<li id="home" class="first"><a href="adminlogin.php" title="Takes you to your home page"><b>Home</b></a></li>
			<li id="single"><a href="facultyadmin.php" title="View Faculty Details"><b>Faculty Search</b></a></li>
			<li id="home"><a href="studentadmin.php" title="View Student Details"><b>Student Search</b></a></li>
			<li id="dropline"><a href="myprofile.php" title="Your Profile"><b>My Profile</b></a></li>
			<li id="flyout"><a href="changepassword.php" title="Change your current password"><b>Change Password</b></a></li>
			<li id="support"><a href="logout.php" title="Logout from this system"><b>Logout</b></a></li>
		</ul>
	</div>
    <br>

<div id="wrapper" style="float:left">
  <div class="form-container">
    <form   autocomplete="off"     enctype="multipart/form-data"  action="changepassword.php" method="POST"  >

 <?php if(isset($message)) { echo '<div  class="box green">'.$message.'</div>'; } ?>
 <?php if(isset($error)) { echo '<div  class="box red">'.$error.'</div>'; } ?>

	<p class="legend"><strong>Note:</strong> Required fields are marked with an asterisk (<em>*</em>)</p>
	
	<fieldset>
		<legend>Change Password</legend>
			<div><label <?php if($val==4){ echo 'class="error"'; }?> for="uname" >Current Password <em>*</em></label> <input <?php if($val==4){ echo 'class="error"'; }?> id="uname" type="password" value="<?php if($val!=0 && isset($_POST['old_password'])) { echo $_POST['old_password'];} ?>" name="old_password"   /></div>
			<div><label <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?> for="email">New Password <em>*</em></label> <input <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?> id="email" type="password" name="new_password"  value="" />
			</div>
			<div><label <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?> for="uname" >Confirm New Password <em>*</em></label> <input <?php if($val==1||$val==2||$val==3){ echo 'class="error"'; }?> id="uname" type="password" value="" name="confirm_password"   /></div>
	</fieldset>
	<div class="buttonrow">
		<input type="submit" name="Submit" value="Change"  />
	</div>
</form> 
</div>    
</div>




<hr>
<?php include('../footer.php') ?>
</div>
</body>
</html>
