<?php

// Report all PHP errors
//error_reporting(-1);
ini_set("display_errors",'1');
//echo "<pre>";print_r(ini_get_all());echo "</pre>";
//echo ini_get('display_errors');
//exit(0);
//var_dump($_SERVER);exit(0);
define('DS', DIRECTORY_SEPARATOR);
define('ROOT', dirname(dirname(__FILE__)));
define('CLASSPATH', ROOT.DS.'model'.DS);
define('VIEWPATH', ROOT.DS.'layout'.DS);
define('CONTROLLERPATH', ROOT.DS.'controller'.DS);
define("COMMONVIEW", ROOT.DS.'layout'.DS.'common'.DS);
define('NOTFOUND', VIEWPATH.'404.html');
//print_r($_REQUEST);echo ROOT.' $ '.DS;exit(0);
if ( $_REQUEST )
{
    require(CLASSPATH."db.class.php");
    require(CLASSPATH."User.class.php");
    require(CLASSPATH."Test.class.php");
    require(CLASSPATH."Question.class.php");

    $controller  = CONTROLLERPATH.$_REQUEST['action'].'.php';
    if ( file_exists($controller) )
    {
        $res = explode('/', $_REQUEST['request']);
        $user = new User($res[1]);
        $page['nav'] = array();
     /**Creating the Navigation**/   
        /*if ($user->type == 1 )
        {
            global $page;*/
$page['nav'] = array('home'=>array('link'=>'/home/'.$res[1],
                                    'icon'=>'icon-home'),
                     'attempted tests'=>array('link'=>'/attempt/'.$res[1]),
                     'scheduled tests'=>array('link'=>'/schedule/'.$res[1]),
                     'new test'=>array('link'=>'/create/'.$res[1]),
                     'reports'=>array('link'=>'/report/'.$res[1]));
//print_r($user->type);
if ( $user->type == 1)
{
    $page['nav']['home']['enable'] = 'YES';
    $page['nav']['scheduled tests']['enable'] = 'YES';
    $page['nav']['attempted tests']['enable'] = 'YES';
}
elseif ( $user->type == 2)
{
    $page['nav']['home']['enable'] = 'YES';
    $page['nav']['new test']['enable'] = 'YES';
    $page['nav']['reports']['enable'] = 'YES';
    
}
       /* }
        elseif ( $user->type == 2 )
        {
            global $page;
            $page['nav'] = array('home'=>array('active'=>'',
                                                'link'=>'home/'.$res[1],
                                                'icon'=>'icon-home'),
                                 'new test'=>array('active'=>'',
                                                'link'=>'create/'.$res[1],
                                                'icon'=>''),
                                 'reports'=>array('active'=>'',
                                                'link'=>'report/'.$res[1],
                                                'icon'=>''));
            
        }*/
    /*Redirect to Specified Controller*/
    include ($controller);
    //include($controller.'?req='.$_REQUEST['request']);
    }
 else {
    /** Redirect to Page not Found **/
     include (NOTFOUND);
    }
}
 else {

     /*Set default controller as Login**/
     header("Location: /login");
     
}



?>
