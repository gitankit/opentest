<?php

/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/**
 * Description of db
 *
 * @author Ankit
 */
class Db {
    //put your code here

    public function __construct() {
        $this->connect();
    }
    
    public $link;
    public $result = NULL;
    public $affected_rows;
    
    public function connect() {
        $this->link = new mysqli("localhost", "ot", "ot_password", 
                        "opentest") or die ("Cannot connect".  mysqli_errno());
    
    }
    
    public function __destruct() {
        $this->link->close();
    }
    /*For SELECT statements*/
    public function query($query) {
        //print_r($query);
        //$query = $this->link->real_escape_string($query);
        //echo $query;
        $res = $this->link->query($query) or die($this->link->error);
        //print_r($res->fetch_assoc());
        if ( $res->num_rows > 0 )
        {
        while ( $row = $res->fetch_assoc()) {
        //foreach ( $row = $res->fetch_assoc() as $value ){
            //print_r($key.':'.$value);
            $result[] = $row;
        }
        $this->affected_rows =  $this->link->affected_rows;
        }
        
        else {
            return FALSE;
        }
        return $result;
        //print_r($this->result);
        //$this->result = $res->fetch_all();
        //$this->result = $res->fetch_assoc();
        //$this->affected_rows = $res->num_rows;
        $res->free();
        //$this->result = NULL;
        //$this->link->close();
    }
    
    /*For INSERT,UPDATE etc functions*/
    public function execute($query) {
        $res = $this->link->query($query) or die ($this->link->error);
        $this->affected_rows = $this->link->affected_rows;
        //$res->free();
    }
}

?>
