<?php

Class Test {
    
    public $id;
    public $name;
    public $max_marks;
    public $timelimit;
    public $enabled;
    public $created_by;
    public $mark;
    public $show_ans;
    public $show_res;
    public $date_created;
    public $negative_mark;
    public $pass_marks;
    public $created_on;
    public $questions;
    public $scheduled;
    public $students;
    
    private $_db;
    
    public function __construct($test_id=NULL) {
     $this->_db = new Db();
     //$this->id = isset($test_id) ? $test_id:NULL;
     if ( isset($test_id) ) {
         $this->id = $test_id;
         $this->get_test_details();
     }
     else {
         $this->id = NULL;
     }
 }
 
 public function new_test($name,$max_marks,$time_limit,
            $date_scheduled,$pass_marks,$created_by,$negative_mark,$mark,
            $show_ans,$show_res) {
     //print_r($show_res);
     $query = "INSERT INTO quiz (name,
                                 max_marks,
                                 time_limit,
                                 schedule_date,
                                 pass_marks,
                                 created_by,
                                 negative_mark,
                                 mark,
                                 show_ans,
                                 show_res) VALUES 
                                 ('$name',
                                   $max_marks,
                                   $time_limit,
                                   '$date_scheduled',
                                   $pass_marks,
                                   $created_by,
                                   $negative_mark,
                                   $mark,
                                   $show_ans,
                                   $show_res)";
     //echo $query;exit(0);
     $this->_db->execute($query);
     if ( $this->_db->affected_rows === 1 ) {
         return TRUE;
     }
     else {
         return FALSE;
     }
     
 }
 
 public function get_test_details() {
     //$query = "SELECT * FROM quiz WHERE id=$this->id
     $query = "SELECT *,(SELECT COUNT(*) FROM quiz_details WHERE quiz=id) question,
                (SELECT COUNT(*) FROM result WHERE quiz=id) students 
                FROM quiz WHERE id=$this->id" ;
     $result = $this->_db->query($query);
     //var_dump($this->_id);
     //var_dump($result);
     //$this->id = $result[0]['id'];
     $this->name = $result[0]['name'];
     $this->max_marks = $result[0]['max_marks'];
     $this->pass_marks = $result[0]['pass_marks'];
     $this->negative_mark = $result[0]['negative_mark'];
     $this->mark = $result[0]['mark'];
     $this->timelimit = $result[0]['time_limit'];
     $this->created_on = $result[0]['date_created'];
     $this->show_ans = $result[0]['show_ans'];
     $this->show_res = $result[0]['show_res'];
     $this->questions = $result[0]['question'];
     $this->scheduled = $result[0]['schedule_date'];
     $this->created_by = $result[0]['created_by'];
     $this->enabled = $result[0]['enabled'];
     $this->students = $result[0]['students'];
 }
 
 public function get_test_details_user($user) {
     //$query = "SELECT * FROM quiz WHERE created_by=$user";
     $query = "SELECT *,(SELECT COUNT(*) FROM quiz_details WHERE quiz=id) question,
                (SELECT COUNT(*) FROM result WHERE quiz=id) students 
                FROM quiz WHERE created_by=$user" ;
     $result = $this->_db->query($query);
     //var_dump($this->_id);
     //var_dump($result);
     /*foreach ($result as $value) {
         var_dump($value);*/
     return $result;
     
 }
 
 
}

?>
